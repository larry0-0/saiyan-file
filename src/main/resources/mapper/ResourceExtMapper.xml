<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.mgentertainment.file.dal.mapper.ResourceExtMapper">
    <resultMap id="BaseResultMap" type="co.mgentertainment.file.dal.po.ResourceExtDO">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Sep 28 17:22:56 GST 2023.
        -->
        <id column="rid" jdbcType="BIGINT" property="rid"/>
        <result column="filename" jdbcType="VARCHAR" property="filename"/>
        <result column="folder" jdbcType="VARCHAR" property="folder"/>
        <result column="size" jdbcType="DECIMAL" property="size"/>
        <result column="duration" jdbcType="INTEGER" property="duration"/>
        <result column="app_code" jdbcType="VARCHAR" property="appCode"/>
        <result column="upload_id" jdbcType="BIGINT" property="uploadId"/>
        <result column="title" jdbcType="VARCHAR" property="title"/>
        <result column="type" jdbcType="SMALLINT" property="type"/>
        <result column="status" jdbcType="SMALLINT" property="status"/>
        <result column="sub_status" jdbcType="SMALLINT" property="subStatus"/>
        <result column="has_trailer" jdbcType="TINYINT" property="hasTrailer"/>
        <result column="has_short" jdbcType="TINYINT" property="hasShort"/>
        <result column="has_cover" jdbcType="TINYINT" property="hasCover"/>
        <result column="trailer_duration" jdbcType="INTEGER" property="trailerDuration"/>
        <result column="short_duration" jdbcType="INTEGER" property="shortDuration"/>
        <result column="trailer_start_pos" jdbcType="INTEGER" property="trailerStartPos"/>
        <result column="short_start_pos" jdbcType="INTEGER" property="shortStartPos"/>
    </resultMap>

    <select id="selectByUploadId" parameterType="java.lang.Long" resultMap="BaseResultMap">
        select r.rid,
               r.filename,
               r.folder,
               r.size,
               r.duration,
               r.app_code,
               fr.upload_id,
               fr.title,
               fr.type,
               fr.status,
               fr.sub_status,
               fr.has_trailer,
               fr.has_short,
               fr.has_cover,
               fr.trailer_duration,
               fr.short_duration,
               fr.trailer_start_pos,
               fr.short_start_pos
        from file_upload fr
                 left join resource r on fr.rid = r.rid
        where fr.upload_id = #{uploadId,jdbcType=BIGINT}
    </select>

    <resultMap id="ResourceResultMap" type="co.mgentertainment.file.dal.po.ResourceDO">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Sep 28 17:22:56 GST 2023.
        -->
        <id column="rid" jdbcType="BIGINT" property="rid"/>
        <result column="filename" jdbcType="VARCHAR" property="filename"/>
        <result column="folder" jdbcType="VARCHAR" property="folder"/>
        <result column="size" jdbcType="DECIMAL" property="size"/>
        <result column="type" jdbcType="SMALLINT" property="type"/>
        <result column="duration" jdbcType="INTEGER" property="duration"/>
        <result column="app_code" jdbcType="VARCHAR" property="appCode"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="updated_time" jdbcType="TIMESTAMP" property="updatedTime"/>
        <result column="deleted" jdbcType="TINYINT" property="deleted"/>
    </resultMap>

    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Sep 28 17:22:56 GST 2023.
        -->
        rid, filename, folder, size, type, duration, app_code, create_time, updated_time, deleted
    </sql>

    <select id="selectByUploadIds" resultMap="ResourceResultMap">
        select
        <include refid="Base_Column_List"/>
        from resource r where exists (
        select rid from file_upload fu where fu.rid=r.rid
        <foreach collection="uploadIds" item="uploadId" open="and fu.upload_id in (" separator="," close=")">
            #{uploadId}
        </foreach>
        )
    </select>


</mapper>